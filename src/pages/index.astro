---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout>
  <head>
    <link rel="stylesheet" href="/assets/css/cookieconsent.css">
    <title>Iana Glushach - Bonsai and Ceramics</title>
    <!-- Load reCAPTCHA v3 -->
    <script src="https://www.google.com/recaptcha/api.js?render=6Le5ZXcqAAAAAG6OhIsAINI2jjhiYeuVFNsrgiKB"></script>
  </head>

  <body>
    <div class="parent">
      <!-- [Previous content remains unchanged until form section] -->

      <!-- Form Section -->
      <div class="div8">
        <form id="subscribeForm" class="subscribe-form">
          <!-- Email Input -->
          <input 
            type="email" 
            name="email" 
            id="emailInput"
            placeholder="Enter your e-mail" 
            aria-label="Email Input" 
            required 
          />
          
          <!-- Submit Button -->
          <button type="submit" id="submitButton">Notify Me</button>
        </form>

        <!-- Success Message -->
        <div id="successMessage" class="success-message" style="display: none;">
          <h2>Thank you for subscribing!</h2>
          <p>We will notify you when our website launches.</p>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="error-message" style="display: none;">
          <h2>Submission Error</h2>
          <p id="errorText">Please try again later.</p>
        </div>
      </div>

      <!-- [Rest of content remains unchanged] -->
    </div>

    <!-- Form Handling Script -->
    <script>
      document.getElementById('subscribeForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.target;
        const button = document.getElementById('submitButton');
        const successMsg = document.getElementById('successMessage');
        const errorMsg = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const emailInput = document.getElementById('emailInput');
        
        // Reset messages
        successMsg.style.display = 'none';
        errorMsg.style.display = 'none';
        
        // Show loading state
        button.disabled = true;
        button.textContent = 'Sending...';
        
        try {
          // Get reCAPTCHA token
          const token = await grecaptcha.execute('6Le5ZXcqAAAAAG6OhIsAINI2jjhiYeuVFNsrgiKB', { 
            action: 'submit' 
          });

          // Submit form data
          const response = await fetch('/api/subscribe', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              email: emailInput.value,
              'g-recaptcha-response': token
            })
          });

          const result = await response.json();

          if (response.ok) {
            form.style.display = 'none';
            successMsg.style.display = 'block';
          } else {
            throw new Error(result.error || 'Submission failed');
          }
        } catch (error) {
          console.error('Error:', error);
          errorText.textContent = error.message || 'Please try again later.';
          errorMsg.style.display = 'block';
        } finally {
          button.disabled = false;
          button.textContent = 'Notify Me';
        }
      });
    </script>

    <!-- [Keep existing Cookie Consent script] -->
  </body>
</BaseLayout>
