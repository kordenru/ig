---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout>
  <head>
    <link rel="stylesheet" href="/assets/css/cookieconsent.css">
    <!-- Add this to force Netlify form detection -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        if (window.netlifyIdentity) {
          window.netlifyIdentity.on('init', (user) => {
            if (!user) {
              window.netlifyIdentity.on('login', () => {
                document.location.href = '/admin/';
              });
            }
          });
        }
      });
    </script>
  </head>

  <body>
    <div class="parent">
      <!-- [All your existing content...] -->

      <!-- Updated Form with Netlify detection fixes -->
      <div class="div8">
        <form 
          name="subscribe"
          method="POST"
          netlify
          netlify-honeypot="bot-field"
          data-netlify="true"
          class="subscribe-form"
          action="/?form_submitted=true"
        >
          <!-- Required hidden fields -->
          <input type="hidden" name="form-name" value="subscribe" />
          <input type="hidden" name="bot-field" value="" />
          
          <!-- Email Input -->
          <input 
            type="email" 
            name="email" 
            placeholder="Enter your e-mail" 
            aria-label="Email Input" 
            required 
          />
          
          <!-- Submit Button -->
          <button type="submit">Notify Me</button>
        </form>

        <!-- Success Message -->
        <div id="successMessage" class="success-message" style="display: none;">
          <h2>Thank you for subscribing!</h2>
          <p>We will notify you when our website launches.</p>
        </div>
      </div>

      <!-- [Rest of your existing content...] -->
    </div>

    <!-- Required Netlify scripts -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script>
      // Enhanced form detection and handling
      document.addEventListener('DOMContentLoaded', function() {
        // Handle form submission feedback
        const params = new URLSearchParams(window.location.search);
        if (params.has('form_submitted')) {
          document.getElementById('subscribeForm').style.display = 'none';
          document.getElementById('successMessage').style.display = 'block';
        }

        // Force Netlify form detection
        if (window.netlifyIdentity) {
          window.netlifyIdentity.on('init', (user) => {
            if (!user) {
              window.netlifyIdentity.on('login', () => {
                document.location.href = '/admin/';
              });
            }
          });
        }
      });
    </script>

    <!-- [Your existing Cookie Consent scripts...] -->
  </body>
</BaseLayout>
