---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout>
  <head>
    <link rel="stylesheet" href="/assets/css/cookieconsent.css">
  </head>

  <body>
    <!-- ... (keep all existing body content the same until the form) ... -->

    <!-- Subscription form -->
    <div class="div8">
      <form id="subscribeForm" action="/api/subscribe" method="POST" class="subscribe-form">
        <input type="email" name="email" placeholder="Enter your e-mail" aria-label="Email Input" required />
        <button type="submit">Notify Me</button>
      </form>

      <!-- ... (keep success/error messages the same) ... -->
    </div>

    <!-- ... (keep rest of body content the same) ... -->

    <!-- Update reCAPTCHA script with render parameter -->
    <script src="https://www.google.com/recaptcha/api.js?render=6Le5ZXcqAAAAAG6OhIsAINI2jjhiYeuVFNsrgiKB"></script>

    <!-- Cookie Consent scripts remain unchanged -->

    <!-- Updated JavaScript handling -->
    <script>
      document.getElementById('subscribeForm').addEventListener('submit', function(event) {
        event.preventDefault();
        
        grecaptcha.ready(() => {
          grecaptcha.execute('6Le5ZXcqAAAAAG6OhIsAINI2jjhiYeuVFNsrgiKB', { 
            action: 'submit' 
          }).then((token) => {
            const form = document.getElementById('subscribeForm');
            const formData = new FormData(form);
            formData.append('g-recaptcha-response', token);

            fetch(form.action, {
              method: 'POST',
              body: new URLSearchParams(formData),
              headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
              },
            })
            .then(response => {
              if (!response.ok) throw new Error('Server error');
              return response.text();
            })
            .then(() => {
              form.style.display = 'none';
              document.getElementById('successMessage').style.display = 'block';
            })
            .catch((error) => {
              document.getElementById('errorMessage').style.display = 'block';
              console.error('Error:', error);
            });
          });
        });
      });
    </script>
  </body>
</BaseLayout>
