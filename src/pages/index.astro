---
import BaseLayout from "../layouts/BaseLayout.astro";
---
<BaseLayout>
  <head>
    <!-- CookieConsent CSS -->
    <link rel="stylesheet" href="/assets/css/cookieconsent.css">
  </head>

  <body>
    <div class="parent">
      <!-- Logo and Text Block -->
      <div class="div2">
        <div class="logo-container">
          <img src="/assets/icons/ig-logo.svg" alt="Company Logo" class="logo-image" />
        </div>
        <div class="text-container">
          <div class="text-block">
            <h2>IANA GLUSHACH</h2>
            <hr class="separator-line" />
            <p class="b-c-text">Bonsai and Ceramics</p>
          </div>
        </div>
      </div>

      <!-- "We Are Coming Soon" -->
      <div class="div6">
        <h2>Our new website is on its way!</h2>
      </div>

      <!-- Tagline -->
      <div class="div7">
        <p class="tagline">
          We’re putting the final touches in place, and we can’t wait to share it with you.<br />
          In the meantime, visit our <a href="https://www.etsy.com/shop/IGBonsaiCeramics" target="_blank" class="etsy-store-link">Etsy Store.</a>
        </p>
      </div>

      <!-- Subscription form -->
      <div class="div8">
        <form method="POST" action="/.netlify/functions/server" data-netlify="true" netlify-honeypot="bot-field" id="subscribeForm" class="subscribe-form">
          <!-- Hidden fields -->
          <input type="hidden" name="form-name" value="subscribe" />
          <input type="hidden" name="submission-date" id="submissionDate" />
          <input type="hidden" name="ip-address" id="ipAddress" />

          <!-- Honeypot field -->
          <p hidden>
            <label>Don’t fill this out if you're human: <input name="bot-field" /></label>
          </p>

          <!-- Email input -->
          <input type="email" name="email" placeholder="Enter your e-mail" aria-label="Email Input" required />

          <!-- Submit button with reCAPTCHA -->
          <button
            type="submit"
            class="g-recaptcha"
            data-sitekey="6Lf-nHcqAAAAALnC28_7N03OgK3kdOhFEw-sVrG9"
            data-callback="onReCaptchaSuccess"
            data-size="invisible"
          >
            Notify Me
          </button>
        </form>

        <!-- Success and Error Messages -->
        <div id="successMessage" class="success-message" style="display: none;">
          <h2>Thank you for subscribing!</h2>
          <p>We will notify you when our website launches.</p>
        </div>
        <div id="errorMessage" class="error-message" style="display: none;">
          <h2>An error occurred!</h2>
          <p>Please try again later.</p>
        </div>
      </div>

      <!-- Follow us section -->
      <div class="div9">
        <h3>Follow us on</h3>
      </div>
      <div class="div10">
        <div class="social-icons">
          <a href="https://www.instagram.com/ig_bonsai_ceramics/" target="_blank" aria-label="Instagram">
            <img src="/assets/icons/insta.png" alt="Instagram" />
          </a>
          <a href="https://www.facebook.com/IGbonsaiCeramics/" target="_blank" aria-label="Facebook">
            <img src="/assets/icons/facebook.png" alt="Facebook" />
          </a>
        </div>
      </div>

      <!-- Footer -->
      <div class="div13">
        <footer>
          2024 &copy; Iana Glushach Bonsai and Ceramics - All Rights Reserved
        </footer>
      </div>
    </div>

    <!-- Include Google reCAPTCHA -->
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>

    <!-- Cookie Consent UMD Script -->
    <script src="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@3.0.1/dist/cookieconsent.umd.js"></script>

    <!-- CookieConsent Configuration Script -->
    <script>
      document.documentElement.classList.add('cc--darkmode');

      CookieConsent.run({
        guiOptions: {
          consentModal: { layout: "box", position: "bottom right" },
          preferencesModal: { layout: "box", position: "right" },
        },
        language: {
          default: "en",
          translations: {
            en: {
              consentModal: {
                title: "We use cookies.",
                description:
                  "This website uses cookies to improve your browsing experience.",
                acceptAllBtn: "Accept all",
                acceptNecessaryBtn: "Reject all",
              },
            },
          },
        },
      });

      // Google reCAPTCHA callback function
      window.onReCaptchaSuccess = async function onReCaptchaSuccess(token) {
        const form = document.getElementById('subscribeForm');
        const now = new Date();
        document.getElementById('submissionDate').value = now.toISOString();

        // Fetch IP address dynamically
        try {
          const ipResponse = await fetch("https://api.ipify.org?format=json");
          const ipData = await ipResponse.json();
          document.getElementById('ipAddress').value = ipData.ip;
        } catch (error) {
          console.error("Failed to fetch IP address:", error);
        }

        const formData = new FormData(form);
        formData.append('g-recaptcha-response', token);

        fetch(form.action, {
          method: 'POST',
          body: new URLSearchParams(formData),
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error('Server error');
            }
            document.getElementById('subscribeForm').style.display = 'none';
            document.getElementById('successMessage').style.display = 'block';
          })
          .catch((error) => {
            console.error(error.message);
            document.getElementById('errorMessage').style.display = 'block';
          });
      };
    </script>
  </body>
</BaseLayout>
