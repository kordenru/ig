---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout>
  <head>
    <link rel="stylesheet" href="/assets/css/cookieconsent.css">
  </head>

  <body>
    <!-- Keep all your existing body structure -->
    <div class="parent">
      <!-- ... all your existing content ... -->

      <!-- Subscription form -->
      <div class="div8">
        <form id="subscribeForm" class="subscribe-form">
          <input 
            type="email" 
            name="email" 
            placeholder="Enter your e-mail" 
            aria-label="Email Input" 
            required 
          />
          <button type="submit">Notify Me</button>
        </form>

        <!-- Messages (keep these the same) -->
        <div id="successMessage" class="success-message" style="display: none;">
          <h2>Thank you for subscribing!</h2>
          <p>We will notify you when our website launches.</p>
        </div>
        <div id="errorMessage" class="error-message" style="display: none;">
          <h2>An error occurred!</h2>
          <p>Please try again later.</p>
        </div>
      </div>

      <!-- ... rest of your content ... -->
    </div>

    <!-- reCAPTCHA v3 -->
    <script src="https://www.google.com/recaptcha/api.js?render=6Le5ZXcqAAAAAG6OhIsAINI2jjhiYeuVFNsrgiKB"></script>

    <!-- Cookie Consent (keep this the same) -->

    <!-- Revised Form Handling -->
    <script>
      document.getElementById('subscribeForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Show loading state
        const btn = this.querySelector('button');
        btn.disabled = true;
        btn.textContent = 'Sending...';

        grecaptcha.ready(() => {
          grecaptcha.execute('6Le5ZXcqAAAAAG6OhIsAINI2jjhiYeuVFNsrgiKB', { 
            action: 'submit' 
          }).then(token => {
            // Simple fallback for testing
            console.log('reCAPTCHA token:', token);
            
            // Simulate success for demonstration
            setTimeout(() => {
              this.style.display = 'none';
              document.getElementById('successMessage').style.display = 'block';
              btn.disabled = false;
              btn.textContent = 'Notify Me';
            }, 1000);

            /* For real use, uncomment and replace with:
            fetch('YOUR_ENDPOINT_HERE', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                email: this.email.value,
                token: token
              })
            })
            .then(response => {
              if (response.ok) {
                this.style.display = 'none';
                document.getElementById('successMessage').style.display = 'block';
              } else {
                throw new Error('Failed');
              }
            })
            .catch(error => {
              document.getElementById('errorMessage').style.display = 'block';
            })
            .finally(() => {
              btn.disabled = false;
              btn.textContent = 'Notify Me';
            });
            */
          }).catch(error => {
            console.error('reCAPTCHA Error:', error);
            document.getElementById('errorMessage').style.display = 'block';
            btn.disabled = false;
            btn.textContent = 'Notify Me';
          });
        });
      });
    </script>
  </body>
</BaseLayout>
